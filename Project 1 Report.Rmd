---
title: |
 \vspace{5cm} <center> STP 494 </center>
 <center> Exploring Data in R and Python </center>
 <center> Project 1 </center>
 <center> Exploring Cancer Data </center>
author: "Nathan Nguyen"
date: "4/22/2020"
output: 
  pdf_document:
    latex_engine: xelatex
mainfont: Cambria
fontsize: 12
urlcolor: blue
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(tidyverse)
library(ggplot2)
library(usmap)
library(scales)
library(knitr)
library(ggpubr)
setwd("/Users/natha/SARS_COV2...") #change this if you run it
```
\newpage
## Introduction
I chose to explore the Centers for Disease Control and Prevention's United States Cancer Statistics (UCSC) for the year 2016. My motivation for working with the data provided is that I'm interested in public health, but primarily the study of epidemiology and the mathematical modelling side of things, rather than statistical analysis, e.g., stability analysis, bifurcations, time-delayed ODES, etc. 
\par
I would have liked to work with COVID-19 data, but I didn't want to do a lot of digging around for data and then having to process it. There was some data wrangling involved in my project, but it is no where near to what I would have hand to have done had I did something on COVID-19. Fortunately, the dataset I used was organized, to an extent for me. The investigators counted all of the cancer cases per cancer, per age group for, and organised them by state, which made things much easier for me. The dataset included information about new cases (incidents) of all types of cancers aggregated by state for the year 2016. Since the aggregation by age group was done prior to releasing this dataset, I will not include any tables displaying the distribution of cancer cases by group, but I will demonstrate how to perform calculations for age groups.

\par
My presentation is a bit on the novice level as well, as I took STP 494: Introductory Applied Statistics over a year ago, and I have largely forgotten the specifics of different types of study methods, e.g., case-control, cohort (retrospective and prospective), ecological studies, etc. I worked on this project alone and I almost forgot about it, so I didn't want to put extreme effort into this. I have several other classes.

\par
I wanted to briefly discuss the importance of data visualization, and how little details could be misleading, e.g., colours used for gradient choropleth maps, why labels are important, etc. I also wanted to discuss why we even care about public health data, and what factors can influence preliminary studies, and what we should consider when looking at data, e.g., adjusted data. I then included several graphs and some slides of codes. 

\par 
One last note, if you wish to compile this yourself to check for validity, you must change your working directory in the set up R code chunk above. I will include the necessary files for you (csv file, and the logo.).
\par
Here is the presentation that was supposed to go along with it. The slides are not in order with this, as I modified the report order. \newline
<http://rpubs.com/maths_student/603437>
\newpage
## Slide 1
```{r, eval = TRUE, echo = FALSE}
# data <- read.csv("USCS.csv")
data <- read.csv("/Users/natha/SARS_COV2/USCS.csv")
cancer <- data
attach(cancer)
names(cancer)[1] <- "state"

knitr::kable(
cancer[1:7, 1:7], caption = "Data Used (All Cancer Types Aggregate)"
)
```

Slide one was just a sample of the data that I am working with. I did not calculate the columns here, but I did have to rename the first column. For some reason, that ID wouldn't import properly into R. I also had to use a knitr::kable function to create this table.


\newpage
## Slide 2: Some plots: What do you notice?
```{r, eval = TRUE, echo = FALSE, out.width = '100%', message = FALSE, warning = FALSE}
 p1 <- plot_usmap(data = cancer, values = "CaseCount", color = "black") +
  scale_fill_continuous(low = "white", high = "red4", guide = FALSE)#, name = " All Cancer Case Count\n (2016)", label = scales::comma) +
  # theme(legend.position =  "right")

p3 <- plot_usmap(data = cancer, values = "CaseCount", color = "black") +
  scale_fill_continuous(low = "white", high = "turquoise1", guide = FALSE)#, name = " All Cancer Case Count\n (2016)", label = scales::comma) +
  # theme(legend.position =  "right")

# require(gridExtra)
# grid.arrange(p1, p3, ncol = 2)
ggarrange(p1, p3, ncol = 2)
```

On this slide, I wanted to pose these questions to the class: What do you notice? What's wrong? What do you think is going on here? 
This slide would have been the primer for my discussion on why it is important to label graphs and why attributes (colours for example) matter a lot when creating graphs for people. One may assume that the blue graph represents something good, and the red one is bad right? 

\newpage

## Things To Consider When Working With Public Health Data
- Characteristics of the Population at Risk and Studied Population
- Factors that can influence Preliminary Study Findings
- Why do we correct/adjust our data? 
- Why do we even care about this data? 
- What are the important elements data of visualization?

## Slide 3: Same Plots
``` {r, eval = TRUE, echo = FALSE, message = FALSE, warning = FALSE}
# This creates a plot of cancer case counts
 pA <- plot_usmap(data = cancer, values = "CaseCount", color = "black") +
  scale_fill_continuous(low = "white", high = "red4", name = " All Cancer Case Count\n (2016)", label = scales::comma) +
  theme(legend.position =  "right")
 
pB <- plot_usmap(data = cancer, values = "CaseCount", color = "black") +
  scale_fill_continuous(low = "white", high = "turquoise1", name = " All Cancer Case Count\n (2016)", label = scales::comma) +
  theme(legend.position =  "right")

ggarrange(pA, pB, nrow = 2, labels = "Is colour important?", hjust = -1.7, vjust = 1.5, font.label = list(size = 10))
```

Well, it turns out that these plots are the same, if you haven't noticed. These chorpleth maps highlight all new cancer case incidents in the United States for 2016. In my opinion, I think choosing red to use for my continuous scale is much better than turquoise. Wouldn't you agree? Red as a implication of severity a "scary" undertone whereas turquoise suggests a more "up-lifting" atmosphere, like something is getting better. The darker the state, the more new incidents the state sees. This is subjective though. If you think turquoise doesn't suggest that something is getting better, then by all means use turquoise to plot an increase of incidence of cancer. The point is that colour is important. Also, red does a much better job at portraying a gradient than turquoise. Take a look at the midwest/Great Lakes area states. Red does a better job at depicting the difference between states than turquoise does. Turquoise makes it look like they're almost all the same. 
\par
Let me ask you a question though, it is obvious that is one of the states with the most amount of new cancer cases reported, but does that mean California has highest incidence rate? In otherwords, are you more likely to develop cancer if you live in California or say Maine?
\par



\newpage
## The Answer No
``` {r, eval = TRUE, echo = FALSE, message = FALSE, warning = FALSE}
# This creates a plot of cancer case counts
cancer <- cancer %>% 
  mutate(CrudeRate = (cancer$CaseCount/cancer$Population) *100000) %>%
  mutate(CrudeRate = round(CrudeRate, 1)) 

# I only want to show these right now
temp1 <- cancer %>%
  select(AgeAdjustedRate, CrudeRate)

 pA <- plot_usmap(data = cancer, values = "CaseCount", color = "black") +
  scale_fill_continuous(low = "white", high = "red4", name = " All Cancer Case Count\n (2016)", label = scales::comma) +
  theme(legend.position =  "right")
 
#plot crude rate
p1 <- plot_usmap(data = cancer, values = "CrudeRate", color = "black") +
  scale_fill_continuous(low = "white", high = "red4", name = "Crude Rate\n Not Adjusted (2016)", label = scales::comma) +
  theme(legend.position =  "right")

ggarrange(pA, p1, nrow = 2)
```
The answer is no! Incidence proportion can be thought of as number of new cases during some time period, in our case the number of cancer cases throughout 2016. Additionally, incidence is a measure of risk, i.e., the probability of an individual developing the disease during a specific time period. In our case, the probability of developing cancer during 2016. 
\par
Take a look at California now on both plots. On the top plot California is dark red, but Maine did a 180 and went from almost white to dark red! In other word, the probability of developing cancer in Maine is higher than it is in California. Now you may wonder why is that?

\par
The answer is not single word answer. The risk factors for cancer can vary, e.g., age, lifestyle (exposure to carcinogens at work), environment (air quality), and so on. I did not look at any data specifically containing distribution by age and other data noting risk factors; they are available. 
\par
I will hypothesize that the population size of California is MUCH larger than Maine, thus the incidence proportion may be lower in California than Maine because the denominator is much larger than Maine's incidence proportion denominator.
\par
Another hypothesis is that maybe Maine's population is older than California's (in general), so thus cancer becomes more prevalent in older populations than younger. I will choose the age hypothesis as a factor affecting incidence proportions to explore. 

\newpage

## Crude Rates
```{r, eval = TRUE, echo = FALSE}
# crude incidence rate per 100,000
cancer <- cancer %>% 
  mutate(CrudeRate = (cancer$CaseCount/cancer$Population) *100000) %>%
  mutate(CrudeRate = round(CrudeRate, 1))

temp1 <- cancer %>%
  select(state, AgeAdjustedRate, CrudeRate)
knitr::kable(
  temp1[1:6, 1:3], caption = "Age Adjusted Rate vs. Crude Rate"
)
```

## Crude Rates
```{r, eval = FALSE, echo = TRUE}
# crude incidence rate per 100,000
cancer <- cancer %>% 
  mutate(CrudeRate = (cancer$CaseCount/cancer$Population) *100000) %>%
  mutate(CrudeRate = round(CrudeRate, 1)) 

# I only want to show these right now
temp1 <- cancer %>%
  select(state, AgeAdjustedRate, CrudeRate)

# displays 3 variables in temp1
knitr::kable(
  temp1[1:6, 1:3], caption = "Age Adjusted Rate vs. Crude Rate"
)
```

## How do you calculate age-adjusted rates? 
<p style="font-size:15px">
\begin{equation}
\text{Age-Specific Crude Rate} = \frac{\text{Age-specific Incidents}}{\text{Age Specific Population}} \times 100,000 
\end{equation}
\begin{equation}
\text{Age-Adjusted Rate} = \text{Crude Rate} \times \text{Age-specific Standard Population Weight}
\end{equation}
\begin{equation}
\text{Age-specific Standard Population Weight} = \frac{\text{Age group standard population}}{\text{Standard Population Total}}
\end{equation}
\par
In this data set, my assumption is that investigators calculated all Age-Specific Crude Rates and Age-Adjusted Rates and then added them up all together by state. We multiply by $100,000$ because we would like to know the incidence rate per $100,000$ individuals.
\par 
I did not perform any explicit calculations to demonstrate, but you may look do your own research. I'm not entirely sure how a standard population is chosen and I'm not 100-percent sure how age-adjusting data achieves more reliable data. I understand biologically why it is important take age into consideration when calculating risks, but I am don't fully understand why age adjusting data achieves it statistically. Perhaps younger people means lower risk, thus the accumulation of "risk" is less when you adjust data? 

\newpage
## Some more Plots
``` {r, eval = TRUE, echo = FALSE, message = FALSE, warning = FALSE}
# This creates a plot of cancer case counts
temp1 <- cancer %>%
  select(AgeAdjustedRate, CrudeRate)

#plot crude rate
p1 <- plot_usmap(data = cancer, values = "CrudeRate", color = "black") +
  scale_fill_continuous(low = "white", high = "red4", name = "Crude Rate\n Not Adjusted (2016)", label = scales::comma) +
  theme(legend.position =  "right")

# plotting incidence rates (age-adjusted)
p2 <- plot_usmap(data = cancer, values = "AgeAdjustedRate", color = "black") +
  scale_fill_continuous(low = "white", high = "red4", name = "Cancer Incidence\nAge-Adjusted (2016)", label = scales::comma) + theme(legend.position =  "right")
 
ggarrange(p1, p2, nrow = 2, hjust = -1.7, vjust = 1.5, font.label = list(size = 10))
```
Again, recall that age could be a risk factor that increases one's probability of developing cancer. 
\par
Take a look at the figure. On the top I have ploted the Crude Rate (not age-adjusted) data by state, and the bottom map us a plot of the age adjusted incidence rates. Though at a quick glance, there might not be a huge difference between the two plots, take a look at the four corners on both plots. 

\par
New Mexico on Crude Rate is pinkish, but when you age-adjust the data, New Mexico is whiter. The Colorado, Arizona and Utah changed colours as well. I do still have my questions on how exactly age-adjusting data reliable, as I don't understand the full details on this statistical measure. Well, it's due to the age-specific standard population weight (the age group's distribution among the total standard population), thus smaller (size) age groups have a smaller weight than (larger size); however, I still have my questions.  

\newpage
## Let's take a look of distribution by state and region
``` {r, eval = TRUE, echo = FALSE, warning = FALSE, fig.height = 3.5, fig.width = 8, fig.align = "left"}

count2 <- cancer %>%
  group_by(state) %>%
  summarise(CaseCount = CaseCount)

# abbreviate state names
x1 <- count2$state
x2 <- state.abb[match(x1,state.name)] # this inadvertently removes District of Columbia could probably

x2[is.na(x2)] <- "DC" # Renames the DC data that was "NA" from last command

p6 <- ggplot(data = count2, aes(x = state, y = CaseCount, group = 1)) +
  geom_histogram(stat = "identity", fill = "darkviolet") +
  scale_x_discrete(labels = x2) + #this wasn't needed afterall
  labs(x = "US States", y = "Cancer Case Count",
       title = "All Cancer Cases Distribution in the US (2016)",
       subtitle = "Cancer cases do not seem to be normally distributed",
       caption = "Data Retrieved from CDC-USCS") + 
  geom_text(aes(label = x2), size = 2.5, vjust = -0.5) +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        axis.ticks.x = element_blank(),
        axis.text.x = element_blank())
p6
```

```{r, eval = TRUE, echo = FALSE, warning = FALSE, fig.height = 4, fig.width = 8, fig.align = "left"}

require(scales)
# VERY cheap way in creating a dataframe. At the moment, 
#I couldn't figure out how to make a data frame of two columns with West ~ 337771, ... so # on
#! There's a much better way to do all of the above and below, I'm sure.

Region <- c('West', 'MidWest', 'South', 'NorthEast')
RegionCount <- c(337771, 624649, 369921, 326375)
Region_Data <- data.frame(Region, RegionCount) # this is very cheap way of doing this, how do I automate?
g2 <- ggplot(data = Region_Data, aes(x = Region, y = RegionCount)) +
  geom_histogram(stat = "identity", fill = "deepskyblue", color = "black") +
  scale_y_continuous(labels = comma) +
  labs(x = "US Geographic Regions", y = "Cancer Case Count (Regional)",
       title = "Distribution of All US Cancer Cases by Region (2016)",
       caption = "Data Retrieved from CDC-USCS") +
  theme(plot.title = element_text(hjust = 0.5))
g2
```

The plots suggest that the 2016 total new cancer cases are not normally distributed across US states, and Mid Western states hold the higher counts than the other three regions. 
\par
My questions are, why does it appear that individuals in Mid-Western states appear to have a higher risk of developing cancer than other regions? What are their risk factors that make them more susceptible than people in other states? If they have the same risk factors, why the deviation? This is a pretty complicated question to answer in all honesty. Public health studies like this need to be conducted on a large scale and there are a lot of factors that go into study designs. It is interesting though. 
\newpage
## A lot of Data Wrangling, probably not optimised :'(
```{r, eval = FALSE, echo = TRUE}
# this huge block of code was me trying to get regional case count
# I didn't know any other way at the moment
NorthEast_Region <- cancer %>% 
  select(state, CaseCount, CrudeRate, AgeAdjustedRate, Population) %>%
  filter(state == 'New York' | state == 'Maine' | state == 'Pennsylvania'|
         state == 'Vermont' | state == 'New Hampshire' | state == 'Massachusetts'|
           state == 'Rhode Island' | state == 'New Jersey' | state == 'Connecticut')

NorthEast_Count <- NorthEast_Region %>%
  summarise(NorthEast_Count = sum(CaseCount))
#-----------------------------------------------

MidWest_Region <- cancer %>% 
  select(state, CaseCount, CrudeRate, AgeAdjustedRate, Population) %>%
  filter(state == 'North Dakota' | state == 'South Dakota' | state == 'North Dakota' |
         state == 'Kansas' | state == 'Minnesota' | state == 'Indiana' |
         state == 'Missouri' | state == 'Wisconsin' | state == 'Illinois' |
         state == 'Iowa' | state == 'Michigan' | state == 'Ohio' | state == 'Nebraska')

MidWest_Count <- MidWest_Region %>%
  summarise(MidWest_Count = sum(CaseCount))
#-------------------------------------------

South_Region <- cancer %>% 
  select(state, CaseCount, CrudeRate, AgeAdjustedRate, Population) %>%
  filter(state == 'Texas'     | state == 'Oklahoma'    | state == 'Arkansas' |
         state == 'Louisiana' | state == 'Mississippi' | state == 'Alabama' |
         state == 'Tennessee' | state == 'Kentucky'    | state == 'Florida' |
         state == 'Georgia'   | state == 'South Carolina'                   |
         state == 'North Carolina' |
         state == 'Virginia'  | state == 'District of Columbia'	|
         state == 'West Virginia' |
         state == 'Maryland'  | state == 'Delaware')

South_Count <- South_Region %>%
  summarise(South_Count = sum(CaseCount))
#------------------------------------------

West_Region <- cancer %>%
  select(state, CaseCount, CrudeRate, AgeAdjustedRate, Population) %>%
  filter(state == 'Alaska' | state == 'Hawaii'     | state == 'California' |
         state == 'Oregon' | state == 'Washington' | state == 'Nevada'     |
         state == 'Idaho'  | state == 'Arizona'    | state == 'Utah'       |
         state == 'Wyoming'| state == 'Montana'    | state == 'New Mexico' |
         state == 'Colorado') 

West_Count <- West_Region %>%
  summarise(West_Count = sum(CaseCount))

# VERY cheap way in creating a dataframe. At the moment, I couldn't figure out how 
# to make a data frame of two columns with West ~ 337771, ... so # on ! 
# There's a much better way to do all of the above and below, I'm sure.
Region <- c('West', 'MidWest', 'South', 'NorthEast')
RegionCount <- c(337771, 624649, 369921, 326375)
Region_Data <- data.frame(Region, RegionCount) 
# this is very cheap way of doing this, how do I automate?

```

\newpage 

## More plots... 
```{r, eval = FALSE, echo = TRUE}

require(scales)
# VERY cheap way in creating a dataframe. At the moment, 
#I couldn't figure out how to make a data frame of two columns with West ~ 337771, ... so # on
#! There's a much better way to do all of the above and below, I'm sure.

Region <- c('West', 'MidWest', 'South', 'NorthEast')
RegionCount <- c(337771, 624649, 369921, 326375)
Region_Data <- data.frame(Region, RegionCount) # this is very cheap way of doing this, how do I automate?
g2 <- ggplot(data = Region_Data, aes(x = Region, y = RegionCount)) +
  geom_histogram(stat = "identity", fill = "deepskyblue", color = "black") +
  scale_y_continuous(labels = comma) +
  labs(x = "US Geographic Regions", y = "Cancer Case Count (Regional)",
       title = "Distribution of All US Cancer Cases by Region (2016)",
       caption = "Data Retrieved from CDC-USCS") +
  theme(plot.title = element_text(hjust = 0.5))
g2
```

\newpage

## References
Cancer Data was pulled from the Centers for Disease Control and Prevention \newline
<https://gis.cdc.gov/Cancer/USCS/DataViz.html> \newline

How I grouped my states by Region \newline
<https://www.businessinsider.com/united-states-regions-new-england-midwest-south-2018-4#the-west-11> \newline

If I were to calculate age adjusted data for this data set, the standard populations used are located here \newline
<https://seer.cancer.gov/stdpopulations/stdpop.19ages.html> \newline

Here's an example of how to calculate age adjusted rates. \newline
<https://seer.cancer.gov/seerstat/tutorials/aarates/step3.html>


